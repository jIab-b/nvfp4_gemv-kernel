### 5.5.5. im2col::w and im2col::w::128 modes 

These modes are similar to the im2col mode with the restriction that elements are accessed across
the `W` dimension only while keeping the `H` and `D` dimension constant.

All the constraints and rules of the im2col mode apply to these modes as well.

The number of elements accessed in the `im2col::w::128` mode is fixed and is equal to 128.
The number of elements accessed in the `im2col::w` mode depends on the field Pixels-per-Column
field in the TensorMap.

#### 5.5.5.1. [Bounding Box](#tensor-im2col-w-w128-modes-bounding-box)[](#tensor-im2col-w-w128-modes-bounding-box "Permalink to this headline")

In these modes, the size of the bounding box in `D` and `H` dimensions are 1.

The `D` and `H` dimensions in the tensor coordinates argument in the PTX instruction specify
the position of the bounding box in the tensor space.

The Bounding-Box `Lower-Corner-W` and Bounding-Box `Upper-Corner-W` specify the two opposite
corners of the Bounding Box in the `W` dimension.

The `W` dimension in the tensor coordinates argument in the PTX instruction specify the location
of the first element that is to be accessed in the bounding box.

Number of pixels loaded in `im2col::w` mode is as specified by Pixels-per-Column in the TensorMap.
Number of pixels loaded in `im2col::w::128` mode is always 128. So, Pixels-per-Column is ignored
in `im2col::w::128` mode.

[Figure 16](#tensor-im2col-w-w128-modes-example) shows an example of the `im2col::w` and
`im2col::w:128` modes.

![_images/tensor-im2col-w-w128-modes-example.png](_images/tensor-im2col-w-w128-modes-example.png)


Figure 16 im2col::w and im2col::w::128 modes example[](#tensor-im2col-w-w128-modes-example "Permalink to this image")

The first element can lie outside of the Bounding Box in the W-dimension only and only on the left
side of the Bounding Box. [Figure 17](#tensor-im2col-w-w128-modes-example2) shows of an example of this.

![_images/tensor-im2col-w-w128-modes-example2.png](_images/tensor-im2col-w-w128-modes-example2.png)


Figure 17 im2col::w and im2col::w::128 modes first element outside Bounding Box example[](#tensor-im2col-w-w128-modes-example2 "Permalink to this image")

#### 5.5.5.2. [Traversal Stride](#tensor-im2col-w-w128-modes-traversal-stride)[](#tensor-im2col-w-w128-modes-traversal-stride "Permalink to this headline")

This is similar to im2col mode with the exception of that the number of elements traversed
along only the `W` dimension is strided by the traversal stride as specified in the TensorMap.

#### 5.5.5.3. [`wHalo`](#tensor-im2col-w-w128-modes-whalo)[](#tensor-im2col-w-w128-modes-whalo "Permalink to this headline")

In `im2col::w` mode, the `wHalo` argument in the PTX instruction specifies how many filter
halo elements must be loaded at the end of the image.

In `im2col::w::128` mode, the halo elements are loaded after every 32 elements in the bounding
box along the `W` dimension. The `wHalo` argument in the PTX instruction specifies how many
halo elements must be loaded after every 32 elements.

Following is an example of `.im2col::w` mode access:

```
Tensor Size [0] = 128

Tensor Size [1] = 9

Tensor Size [2] = 7

Tensor Size [3] = 64

Pixels-per-column = 128

Channels-per-pixel = 64

Bounding Box Lower Corner W = 0

Bounding Box Upper Corner W = 0



Tensor Coordinates in the instruction = (7, 2, 3, 0)

wHalo in the instruction = 2 (as 3x3 convolution filter is used)
```

A tensor copy operation with the above parameters loads 128 pixels and the two halo pixels as shown in
[Figure 18](#tensor-im2col-w-w128-modes-example3).

![_images/tensor-im2col-w-w128-modes-example3.png](_images/tensor-im2col-w-w128-modes-example3.png)


Figure 18 tensor copy operation with im2col::w mode example[](#tensor-im2col-w-w128-modes-example3 "Permalink to this image")

The halo pixels are always loaded in the shared memory next to the main row pixels as shown in
[Figure 18](#tensor-im2col-w-w128-modes-example3).

Following is an example of `.im2col::w::128` mode access:

```
Tensor Size [0] = 128

Tensor Size [1] = 9

Tensor Size [2] = 7

Tensor Size [3] = 64

Channels-per-pixel = 64

Bounding Box Lower Corner W = 0

Bounding Box Upper Corner W = 0



Tensor Coordinates in the instruction = (7, 2, 3, 0)

wHalo in the instruction = 2 (as 3x3 convolution filter is used)
```

A tensor copy operation with the above parameters loads 128 elements such that after every 32 elements,
wHalo number of elements are loaded as shown in [Figure 19](#tensor-im2col-w-w128-modes-example4).

![_images/tensor-im2col-w-w128-modes-example4.png](_images/tensor-im2col-w-w128-modes-example4.png)


Figure 19 tensor copy operation with im2col::w::128 mode example[](#tensor-im2col-w-w128-modes-example4 "Permalink to this image")

#### 5.5.5.4. [`wOffset`](#tensor-im2col-w-w128-modes-woffset)[](#tensor-im2col-w-w128-modes-woffset "Permalink to this headline")

In the convolution calculations, the same elements along the `W` dimension are reused for different
locations within the convolution filter footprint. Based on the number of times a pixel is used, the
pixels may be loaded into different shared memory buffers. Each buffer can be loaded by a separate
tensor copy operation.

The `wOffset` argument in the tensor copy and prefetch instruction adjusts the source pixel location
for each buffer. The exact position of the buffer is adjusted along the `W` dimension using the
following formula:

```
Bounding Box Lower Corner W += wOffset

Bounding Box Upper Corner W += wOffset

W += wOffset
```

Following are examples of tensor copy to multiple buffers with various `wHalo` and `wOffset` values:

Example 1:

```
Tensor Size [0] = 128

Tensor Size [1] = 9

Tensor Size [2] = 67

Tensor Size [3] = 64

Pixels-per-Column = 128

Channels-per-pixel = 64

Bounding Box Lower Corner W = -1

Bounding Box Upper Corner W = 0

Traversal Stride = 2



Tensor Coordinates in the instruction = (7, 2, -1, 0)



Shared memory buffer 1:

   wHalo = 1

   wOffset = 0



Shared memory buffer 2:

   wHalo = 0

   wOffset = 1
```

![_images/tensor-im2col-w-w128-modes-example5.png](_images/tensor-im2col-w-w128-modes-example5.png)


Figure 20 tensor copy operation to buffer 1 of Example 1[](#tensor-im2col-w-w128-modes-example5 "Permalink to this image")


![_images/tensor-im2col-w-w128-modes-example6.png](_images/tensor-im2col-w-w128-modes-example6.png)


Figure 21 tensor copy operation to buffer 2 of Example 1[](#tensor-im2col-w-w128-modes-example6 "Permalink to this image")

Example 2:

```
Tensor Size [0] = 128

Tensor Size [1] = 7

Tensor Size [2] = 7

Tensor Size [3] = 64

Pixels-per-Column = 128

Channels-per-pixel = 64

Bounding Box Lower Corner W = -1

Bounding Box Upper Corner W = -1

Traversal Stride = 3



Tensor Coordinates in the instruction = (7, 2, -1, 0)



Shared memory buffer 1:

   wHalo = 0

   wOffset = 0



Shared memory buffer 2:

   wHalo = 0

   wOffset = 1



Shared memory buffer 3:

   wHalo = 0

   wOffset = 2
```

![_images/tensor-im2col-w-w128-modes-example7.png](_images/tensor-im2col-w-w128-modes-example7.png)


Figure 22 tensor copy operation to buffer 1 of Example 2[](#tensor-im2col-w-w128-modes-example7 "Permalink to this image")


![_images/tensor-im2col-w-w128-modes-example8.png](_images/tensor-im2col-w-w128-modes-example8.png)


Figure 23 tensor copy operation to buffer 2 of Example 2[](#tensor-im2col-w-w128-modes-example8 "Permalink to this image")


![_images/tensor-im2col-w-w128-modes-example9.png](_images/tensor-im2col-w-w128-modes-example9.png)


Figure 24 tensor copy operation to buffer 3 of Example 2[](#tensor-im2col-w-w128-modes-example9 "Permalink to this image")